# SSL VULNERABILITIES

En relacion a este tema, mas que todo se debe testear la seguridad criptografica del mismo. 

- Los protocolos SSL/TLS, los cifrados, las claves y la renegociación deben configurarse correctamente.
- Se debe asegurar la validez del certificado.

- [[#verificar validaciones|verificar validaciones]]
- [[#funcionamiento|funcionamiento]]
- [[#TESTING|TESTING]]
	- [[#HERRAMIENTAS|HERRAMIENTAS]]
	- [[#Pruebas de datos confidenciales transmitidos en texto sin cifrar|Pruebas de datos confidenciales transmitidos en texto sin cifrar]]
		- [[#caja negra|caja negra]]
		- [[#Ejemplo 1: Envío de datos con el método POST a través de HTTP|Ejemplo 1: Envío de datos con el método POST a través de HTTP]]
		- [[#Ejemplo 2: Envío de datos con el método POST a través de HTTPS|Ejemplo 2: Envío de datos con el método POST a través de HTTPS]]
		- [[#Ejemplo 3: envío de datos con el método POST a través de HTTPS en una página accesible a través de HTTP|Ejemplo 3: envío de datos con el método POST a través de HTTPS en una página accesible a través de HTTP]]
		- [[#Ejemplo 4: Envío de datos con el método GET a través de HTTPS|Ejemplo 4: Envío de datos con el método GET a través de HTTPS]]
- [[#Pruebas de vulnerabilidades de cifrados/protocolos/claves SSL/TLS débiles|Pruebas de vulnerabilidades de cifrados/protocolos/claves SSL/TLS débiles]]
- [[#Reconocimiento de servicio TLS/SSL a través de Nmap|Reconocimiento de servicio TLS/SSL a través de Nmap]]
- [[#Comprobación de información de certificado, cifrados débiles y SSLv2 a través de Nmap|Comprobación de información de certificado, cifrados débiles y SSLv2 a través de Nmap]]
- [[#Comprobación de la renegociación iniciada por el cliente y la renegociación segura a través de OpenSSL (manualmente)|Comprobación de la renegociación iniciada por el cliente y la renegociación segura a través de OpenSSL (manualmente)]]
- [[#Prueba de conjuntos de cifrado admitidos, ataques BEAST y CRIME a través de TestSSLServer|Prueba de conjuntos de cifrado admitidos, ataques BEAST y CRIME a través de TestSSLServer]]
- [[#Prueba de vulnerabilidades SSL/TLS con sslyze|Prueba de vulnerabilidades SSL/TLS con sslyze]]
- [[#Prueba de SSL/TLS con testssl.sh|Prueba de SSL/TLS con testssl.sh]]
- [[#Prueba de SSL/TLS con SSL Breacher|Prueba de SSL/TLS con SSL Breacher]]
- [[#Prueba de O-Saft - Herramienta forense avanzada OWASP SSL|Prueba de O-Saft - Herramienta forense avanzada OWASP SSL]]
- [[#Explotación del navegador contra el ataque SSL/TLS (BEAST)|Explotación del navegador contra el ataque SSL/TLS (BEAST)]]
	- [[#Requisitos previos para que funcione el ataque BEAST:|Requisitos previos para que funcione el ataque BEAST:]]
- [[#POC|POC]]
	- [[#Mitigaciones para el ataque BEAST:|Mitigaciones para el ataque BEAST:]]
- [[#POODLE ATTACK|POODLE ATTACK]]
	- [[#POC|POC]]
	- [[#MITIGACION|MITIGACION]]
- [[#CRIME (CVE-2012-4929)|CRIME (CVE-2012-4929)]]
	- [[#POC|POC]]
	- [[#Remediación|Remediación]]
- [[#BREACH|BREACH]]
	- [[#POC|POC]]
	- [[#PREVENSION|PREVENSION]]
- [[#HEARTBEAT|HEARTBEAT]]
	- [[#POC|POC]]
	- [[#Prevención|Prevención]]
- [[#SWEET32|SWEET32]]
	- [[#POC|POC]]
	- [[#MITIGACION|MITIGACION]]
- [[#LUCKY13|LUCKY13]]
	- [[#POC|POC]]
	- [[#MITIGACION|MITIGACION]]
- [[#LOGJAM|LOGJAM]]
	- [[#POC|POC]]
	- [[#MITIGACION|MITIGACION]]
- [[#SSLv2 Y SSLv3 SUPPORT|SSLv2 Y SSLv3 SUPPORT]]
- [[#CIPHER SUITES|CIPHER SUITES]]
- [[#DROWN|DROWN]]
- [[#¿Cuál es la diferencia entre TLS 1.3 y TLS 1.2?|¿Cuál es la diferencia entre TLS 1.3 y TLS 1.2?]]
- [[#¿Qué ventajas tiene utilizar la última versión de TLS?|¿Qué ventajas tiene utilizar la última versión de TLS?]]


## verificar validaciones

- Verificar si la Autoridad de Certificación (CA) es conocida (es decir, una considerada confiable);
- Verificar que el certificado es actualmente válido;
- Verificando que el nombre del sitio y el nombre reportado en el certificado coincidan.

## funcionamiento

- Cada navegador viene con una lista precargada de CA confiables, contra la cual se compara la CA que firma el certificado (esta lista se puede personalizar y expandir a voluntad). Durante las negociaciones iniciales con un servidor HTTPS, si el certificado del servidor se relaciona con una CA desconocida para el navegador, generalmente se genera una advertencia. Esto sucede con mayor frecuencia porque una aplicación web se basa en un certificado firmado por una CA autoestablecida. (Certificado Autofirmado)

- Los certificados tienen asociado un periodo de validez, por lo que pueden caducar. Nuevamente, el navegador nos advierte sobre esto. Un servicio público necesita un certificado temporalmente válido; de lo contrario, significa que estamos hablando con un servidor cuyo certificado fue emitido por alguien en quien confiamos, pero ha caducado sin haber sido renovado.

- ¿Qué sucede si el nombre del certificado y el nombre del servidor no coinciden? Si esto sucede, puede sonar sospechosos

## TESTING

### HERRAMIENTAS

la mayotia de la herramientas son para hacer MITM.

- OWASP Zed Attack Proxy (ZAP)
- mitmproxy
- Burp Suite
- Wireshark
- TCPDUMP

### Pruebas de datos confidenciales transmitidos en texto sin cifrar

#### caja negra

#### Ejemplo 1: Envío de datos con el método POST a través de HTTP

```http
POST http://www.example.com/AuthenticationServlet HTTP/1.1
Host: www.example.com
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; it; rv:1.8.1.14) Gecko/20080404
Accept: text/xml,application/xml,application/xhtml+xml
Accept-Language: it-it,it;q=0.8,en-us;q=0.5,en;q=0.3
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Referer: http://www.example.com/index.jsp
Cookie: JSESSIONID=LVrRRQQXgwyWpW7QMnS49vtW1yBdqn98CGlkP4jTvVCGdyPkmn3S!
Content-Type: application/x-www-form-urlencoded
Content-length: 64

delegated_service=218&User=test&Pass=test&Submit=SUBMIT
```

podemos interceptar la peticion y vamos a poder ver lo datos enviados ya que no esta con HTTPS.

#### Ejemplo 2: Envío de datos con el método POST a través de HTTPS

```http
POST https://www.example.com:443/cgi-bin/login.cgi HTTP/1.1
Host: www.example.com
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; it; rv:1.8.1.14) Gecko/20080404
Accept: text/xml,application/xml,application/xhtml+xml,text/html
Accept-Language: it-it,it;q=0.8,en-us;q=0.5,en;q=0.3
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Referer: https://www.example.com/cgi-bin/login.cgi
Cookie: language=English;
Content-Type: application/x-www-form-urlencoded
Content-length: 50

Command=Login&User=test&Pass=test
```

Podemos ver que la solicitud está dirigida a www.example.com:443/cgi-bin/login.cgi usa el protocolo HTTPS. Esto garantiza que nuestras credenciales se envíen mediante un canal encriptado y que un usuario malicioso no pueda leerlas mediante un rastreador.

#### Ejemplo 3: envío de datos con el método POST a través de HTTPS en una página accesible a través de HTTP

```http
POST https://www.example.com:443/login.do HTTP/1.1
Host: www.example.com
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; it; rv:1.8.1.14) Gecko/20080404
Accept: text/xml,application/xml,application/xhtml+xml,text/html
Accept-Language: it-it,it;q=0.8,en-us;q=0.5,en;q=0.3
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Referer: http://www.example.com/homepage.do
Cookie: SERVTIMSESSIONID=s2JyLkvDJ9ZhX3yr5BJ3DFLkdphH0QNSJ3VQB6pLhjkW6F
Content-Type: application/x-www-form-urlencoded
Content-length: 45

User=test&Pass=test&portal=ExamplePortal
```

Podemos ver que nuestra solicitud está dirigida a www.example.com:443/login.do a través de HTTPS. Pero si echamos un vistazo al encabezado de referencia (la página de la que venimos), es www.example.com/homepage.do y es accesible a través de HTTP simple. Aunque enviamos datos a través de HTTPS, esta implementación puede permitir ataques **SSLStrip**.

**SSLSTRIP**

El funcionamiento de SSLStrip es simple, reemplaza todas las peticiones HTTPS de una página web por HTTP y luego hace un MITM (ataque «Man in the Middle«) entre el servidor y el cliente. La idea es que la víctima y el agresor se comuniquen a través de HTTP, mientras que el atacante y el servidor, se comunican a través de HTTPS con el certificado del servidor. Por lo tanto, el atacante es capaz de ver todo el tráfico en texto plano de la víctima.

1.- Configurar IP Forwarding

```bash
echo 1 > /proc/sys/net/ipv4/ip_forward
```

2.- Realizando ataque ARP MITM entre las 2 maquinas:

```bash
arpspoof -i eth0 -t VICTIMA HOST
```

3.- Redireccionar trafico con iptables:

```bash
iptables -t nat -A PREROUTING -p tcp –destination-port 80 -j REDIRECT –to-ports 8080
```

4.- Iniciar SSLStrip en el puerto utilizado [https://github.com/moxie0/sslstrip](https://github.com/moxie0/sslstrip)

```bash
python sslstrip.py -w archivo
```

**SOLUCION: USAR TODO CON HTTPS**

#### Ejemplo 4: Envío de datos con el método GET a través de HTTPS

```http
GET https://www.example.com/success.html?user=test&pass=test HTTP/1.1
Host: www.example.com
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; it; rv:1.8.1.14) Gecko/20080404
Accept: text/xml,application/xml,application/xhtml+xml,text/html
Accept-Language: it-it,it;q=0.8,en-us;q=0.5,en;q=0.3
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Referer: https://www.example.com/form.html
If-Modified-Since: Mon, 30 Jun 2008 07:55:11 GMT
If-None-Match: "43a01-5b-4868915f"
```

Puede ver que los datos se transfieren en texto claro en la URL y no en el cuerpo de la solicitud como antes. Pero debemos considerar que SSL/TLS es un protocolo de nivel 5, un nivel más bajo que HTTP, por lo que todo el paquete HTTP aún está encriptado, lo que hace que la URL sea ilegible para un usuario malicioso que usa un sniffer. Sin embargo, como se indicó anteriormente, no es una buena práctica utilizar el método GET para enviar datos confidenciales a una aplicación web, ya que la información contenida en la URL se puede almacenar en muchas ubicaciones, como registros de proxy y servidor web.

## Pruebas de vulnerabilidades de cifrados/protocolos/claves SSL/TLS débiles

- No se deben utilizar cifrados débiles.
	- no menos de 128 bits.
	- no Anonymous Diffie-Hellmann, debido a que no proporciona autenticación
- Los protocolos débiles deben estar deshabilitados.
	- SSLv2 y SSLv3 deshabilitado, 
	- TLS 1.1 deshabilitado y TLS 1.2 preferentemente deshabilitdao. Usar TLS 1.3.
- La renegociación debe estar configurada correctamente (por ejemplo, la renegociación insegura debe estar deshabilitada debido a ataques MiTM y la renegociación iniciada por el cliente debe estar deshabilitada debido a una vulnerabilidad de denegación de servicio.
- Sin conjuntos de cifrado de nivel de exportación (EXP), debido a que se pueden romper facilmente.
-  La longitud de la clave de los certificados X.509 debe ser sólida (por ejemplo, si se usa RSA o DSA, la clave debe tener al menos 1024 bits).
-  Los certificados X.509 deben firmarse únicamente con algoritmos hash seguros.
	-  no use MD%, en su lugar SHA256 o SHA512.
- [Las claves deben generarse con la entropía adecuada](https://www.ssllabs.com/projects/rating-guide/index.html) (p. ej., clave débil generada con Debian).

Una lista de verificación más completa incluye:

-   La renegociación segura debe estar habilitada.
-   MD5 no debe usarse debido a [ataques de colisión conocidos](https://link.springer.com/chapter/10.1007/11426639_2) .
-   RC4 no debe usarse debido a [ataques criptoanalíticos](https://community.qualys.com/blogs/securitylabs/2013/03/19/rc4-in-tls-is-broken-now-what) .
-   El servidor debe estar protegido contra [BEAST Attack](https://community.qualys.com/blogs/securitylabs/2011/10/17/mitigating-the-beast-attack-on-tls) .
-   El servidor debe estar protegido contra [ataques CRIME](https://community.qualys.com/blogs/securitylabs/2012/09/14/crime-information-leakage-attack-against-ssltls) , la compresión TLS debe estar deshabilitada.
-   El servidor debe admitir [Forward Secrecy](https://community.qualys.com/blogs/securitylabs/2013/06/25/ssl-labs-deploying-forward-secrecy) .

## Reconocimiento de servicio TLS/SSL a través de Nmap

El primer paso es identificar los puertos que tienen servicios envueltos SSL/TLS. Por lo general, los puertos tcp con SSL para servicios web y de correo son:

- 443 (https),
- 465 (ssmtp)
- 585 (imap4-ssl)
- 993 (imaps)
- 995 (ssl-pop).

con el parametro `-sV` de nmap podemos ver esto:

```bash
nmap -sV --reason -PN -n --top-ports 100 www.example.com
```

resultado:

```bash
...
443/tcp open  ssl/http syn-ack Apache
465/tcp open  ssl/smtp syn-ack Exim smtpd 4.80
993/tcp open  ssl/imap syn-ack Dovecot imapd
995/tcp open  ssl/pop3 syn-ack Dovecot pop3d
```

## Comprobación de información de certificado, cifrados débiles y SSLv2 a través de Nmap

```bash
nmap --script ssl-cert,ssl-enum-ciphers -p 443,465,993,995 www.example.com
```

resultado:

```bash
443/tcp open  https
| ssl-cert: Subject: commonName=www.example.org
| Issuer: commonName=*******
| Public Key type: rsa
| Public Key bits: 1024
| Not valid before: 2010-01-23T00:00:00+00:00
| Not valid after:  2020-02-28T23:59:59+00:00
| MD5:   *******
|_SHA-1: *******
| ssl-enum-ciphers:
|   SSLv3:
|     ciphers:
|       TLS_RSA_WITH_CAMELLIA_128_CBC_SHA - strong
|       TLS_RSA_WITH_CAMELLIA_256_CBC_SHA - strong
|       TLS_RSA_WITH_RC4_128_SHA - strong
|     compressors:
|       NULL
|   TLSv1.0:
|     ciphers:
|       TLS_RSA_WITH_CAMELLIA_128_CBC_SHA - strong
|       TLS_RSA_WITH_CAMELLIA_256_CBC_SHA - strong
|       TLS_RSA_WITH_RC4_128_SHA - strong
|     compressors:
|       NULL
|_  least strength: strong
465/tcp open  smtps
| ssl-cert: Subject: commonName=*.exapmple.com
| Issuer: commonName=*******
| Public Key type: rsa
| Public Key bits: 2048
| Not valid before: 2010-01-23T00:00:00+00:00
| Not valid after:  2020-02-28T23:59:59+00:00
| MD5:   *******
|_SHA-1: *******
| ssl-enum-ciphers:
|   SSLv3:
|     ciphers:
|       TLS_RSA_WITH_CAMELLIA_128_CBC_SHA - strong
|       TLS_RSA_WITH_CAMELLIA_256_CBC_SHA - strong
|       TLS_RSA_WITH_RC4_128_SHA - strong
|     compressors:
|       NULL
|   TLSv1.0:
|     ciphers:
|       TLS_RSA_WITH_CAMELLIA_128_CBC_SHA - strong
|       TLS_RSA_WITH_CAMELLIA_256_CBC_SHA - strong
|       TLS_RSA_WITH_RC4_128_SHA - strong
|     compressors:
|       NULL
|_  least strength: strong
993/tcp open  imaps
| ssl-cert: Subject: commonName=*.exapmple.com
| Issuer: commonName=*******
| Public Key type: rsa
| Public Key bits: 2048
| Not valid before: 2010-01-23T00:00:00+00:00
| Not valid after:  2020-02-28T23:59:59+00:00
| MD5:   *******
|_SHA-1: *******
| ssl-enum-ciphers:
|   SSLv3:
|     ciphers:
|       TLS_RSA_WITH_CAMELLIA_128_CBC_SHA - strong
|       TLS_RSA_WITH_CAMELLIA_256_CBC_SHA - strong
|       TLS_RSA_WITH_RC4_128_SHA - strong
|     compressors:
|       NULL
|   TLSv1.0:
|     ciphers:
|       TLS_RSA_WITH_CAMELLIA_128_CBC_SHA - strong
|       TLS_RSA_WITH_CAMELLIA_256_CBC_SHA - strong
|       TLS_RSA_WITH_RC4_128_SHA - strong
|     compressors:
|       NULL
|_  least strength: strong
995/tcp open  pop3s
| ssl-cert: Subject: commonName=*.exapmple.com
| Issuer: commonName=*******
| Public Key type: rsa
| Public Key bits: 2048
| Not valid before: 2010-01-23T00:00:00+00:00
| Not valid after:  2020-02-28T23:59:59+00:00
| MD5:   *******
|_SHA-1: *******
| ssl-enum-ciphers:
|   SSLv3:
|     ciphers:
|       TLS_RSA_WITH_CAMELLIA_128_CBC_SHA - strong
|       TLS_RSA_WITH_CAMELLIA_256_CBC_SHA - strong
|       TLS_RSA_WITH_RC4_128_SHA - strong
|     compressors:
|       NULL
|   TLSv1.0:
|     ciphers:
|       TLS_RSA_WITH_CAMELLIA_128_CBC_SHA - strong
|       TLS_RSA_WITH_CAMELLIA_256_CBC_SHA - strong
|       TLS_RSA_WITH_RC4_128_SHA - strong
|     compressors:
|       NULL
|_  least strength: strong
Nmap done: 1 IP address (1 host up) scanned in 8.64 seconds
```

## Comprobación de la renegociación iniciada por el cliente y la renegociación segura a través de OpenSSL (manualmente)

[OpenSSL](https://www.openssl.org/) se puede utilizar para probar manualmente SSL/TLS. En este ejemplo, el evaluador intenta iniciar una renegociación mediante la conexión del cliente al servidor con OpenSSL.

```bash
openssl s_client -connect www2.example.com:443
```

resultado:

```bash
CONNECTED(00000003)
depth=2 ******
verify error:num=20:unable to get local issuer certificate
verify return:0
---
Certificate chain
 0 s:******
   i:******
 1 s:******
   i:******
 2 s:******
   i:******
---
Server certificate
-----BEGIN CERTIFICATE-----
******
-----END CERTIFICATE-----
subject=******
issuer=******
---
No client certificate CA names sent
---
SSL handshake has read 3558 bytes and written 640 bytes
---
New, TLSv1/SSLv3, Cipher is DES-CBC3-SHA
Server public key is 2048 bit
Secure Renegotiation IS NOT supported
Compression: NONE
Expansion: NONE
SSL-Session:
    Protocol  : TLSv1
    Cipher    : DES-CBC3-SHA
    Session-ID: ******
    Session-ID-ctx:
    Master-Key: ******
    Key-Arg   : None
    PSK identity: None
    PSK identity hint: None
    SRP username: None
    Start Time: ******
    Timeout   : 300 (sec)
    Verify return code: 20 (unable to get local issuer certificate)
---
```

ahora podemos intentar la renegociacion escribiendo lo siguiente:

```bash
HEAD / HTTP/1.1
R
```

- el metodo HEAD puede variar entre los demas verbos.
- La version de HTTP puede ser 1.0 o 1.1.
- `R` significa salto de linea.

si la respuesta a eso, devuelve el resultado de la peticion HEAD a la pagina web, entonces ES VULNERABLE A UN ATAQUE DE RENEGOCIACION:

resultado vulnerable:

```bash
HEAD / HTTP/1.1

HTTP/1.1 403 Forbidden ( The server denies the specified Uniform Resource Locator (URL). Contact the server administrator.  )
Connection: close
Pragma: no-cache
Cache-Control: no-cache
Content-Type: text/html
Content-Length: 1792  

read:errno=0
```

caso contrario este seria el resultado mas o menos:

```bash
RENEGOTIATING  
140514982606488:error:1409E0E5:SSL routines:ssl3_write_bytes:ssl handshake failure:s3_pkt.c:645:
```

En este caso el servidor sobre el que se ha probado no es vulnerable, ya que al solicitar la renegociación, no lo ha permitido. Sin embargo, si lo hubiese permitido, podríamos a hacer una petición HEAD o GET y nos devolvería la página web.

El ataque SSL/TLS Renegotiation consiste en aprovecharse de esta caracteristica de SSL/TLS mediante la cual un atacante en una posición entre el cliente y el servidor (MITM), el cliente pretende conectarse al servidor, pero con el que se conecta es con el atacante, antes de que el atacante complete el handshake con el cliente, el atacante se conecta al servidor y realiza el handshake, posteriormente realiza una renegociación con el servidor, pero esta vez se la devuelve al cliente, permaneciendo el atacante en una posición intermedia, y con la clave de sesión, por tanto, podrá leer todo lo que se transmita por ese canal "seguro".

##  Prueba de conjuntos de cifrado admitidos, ataques BEAST y CRIME a través de TestSSLServer

[TestSSLServer](https://github.com/pornin/TestSSLServer) es un script que permite al probador verificar el conjunto de cifrado y también los ataques BEAST y CRIME. BEAST (Browser Exploit Against SSL/TLS) aprovecha una vulnerabilidad de CBC en TLS 1.0. CRIME (Compression Ratio Info-leak Made Easy) explota una vulnerabilidad de la compresión TLS, que debe desactivarse.

```bash
TestSSLServer.exe www3.example.com 443
```

resultado:

```bash
Supported cipher suites (ORDER IS NOT SIGNIFICANT):
  SSLv3
     RSA_WITH_RC4_128_SHA
     RSA_WITH_3DES_EDE_CBC_SHA
     DHE_RSA_WITH_3DES_EDE_CBC_SHA
     RSA_WITH_AES_128_CBC_SHA
     DHE_RSA_WITH_AES_128_CBC_SHA
     RSA_WITH_AES_256_CBC_SHA
     DHE_RSA_WITH_AES_256_CBC_SHA
     RSA_WITH_CAMELLIA_128_CBC_SHA
     DHE_RSA_WITH_CAMELLIA_128_CBC_SHA
     RSA_WITH_CAMELLIA_256_CBC_SHA
     DHE_RSA_WITH_CAMELLIA_256_CBC_SHA
     TLS_RSA_WITH_SEED_CBC_SHA
     TLS_DHE_RSA_WITH_SEED_CBC_SHA
  (TLSv1.0: idem)
  (TLSv1.1: idem)
  TLSv1.2
     RSA_WITH_RC4_128_SHA
     RSA_WITH_3DES_EDE_CBC_SHA
     DHE_RSA_WITH_3DES_EDE_CBC_SHA
     RSA_WITH_AES_128_CBC_SHA
     DHE_RSA_WITH_AES_128_CBC_SHA
     RSA_WITH_AES_256_CBC_SHA
     DHE_RSA_WITH_AES_256_CBC_SHA
     RSA_WITH_AES_128_CBC_SHA256
     RSA_WITH_AES_256_CBC_SHA256
     RSA_WITH_CAMELLIA_128_CBC_SHA
     DHE_RSA_WITH_CAMELLIA_128_CBC_SHA
     DHE_RSA_WITH_AES_128_CBC_SHA256
     DHE_RSA_WITH_AES_256_CBC_SHA256
     RSA_WITH_CAMELLIA_256_CBC_SHA
     DHE_RSA_WITH_CAMELLIA_256_CBC_SHA
     TLS_RSA_WITH_SEED_CBC_SHA
     TLS_DHE_RSA_WITH_SEED_CBC_SHA
     TLS_RSA_WITH_AES_128_GCM_SHA256
     TLS_RSA_WITH_AES_256_GCM_SHA384
     TLS_DHE_RSA_WITH_AES_128_GCM_SHA256
     TLS_DHE_RSA_WITH_AES_256_GCM_SHA384
----------------------
Server certificate(s):
  ******
----------------------
Minimal encryption strength:     strong encryption (96-bit or more)
Achievable encryption strength:  strong encryption (96-bit or more)
BEAST status: vulnerable
CRIME status: protected
```

## Prueba de vulnerabilidades SSL/TLS con sslyze

[sslyze](https://github.com/nabla-c0d3/sslyze) es un script de python que permite el escaneo masivo y la salida XML. El siguiente es un ejemplo de un escaneo regular. Es una de las herramientas más completas y versátiles para las pruebas SSL/TLS.

```bash
./sslyze.py --regular example.com:443
```

resultado:

```bash
REGISTERING AVAILABLE PLUGINS
-----------------------------

PluginHSTS
PluginSessionRenegotiation
PluginCertInfo
PluginSessionResumption
PluginOpenSSLCipherSuites
PluginCompression



CHECKING HOST(S) AVAILABILITY
-----------------------------

example.com:443                      => 127.0.0.1:443



SCAN RESULTS FOR EXAMPLE.COM:443 - 127.0.0.1:443
---------------------------------------------------

* Compression :
      Compression Support:      Disabled

* Session Renegotiation :
    Client-initiated Renegotiations:    Rejected
    Secure Renegotiation:               Supported

* Certificate :
    Validation w/ Mozilla's CA Store:  Certificate is NOT Trusted: unable to get local issuer certificate
    Hostname Validation:               MISMATCH
    SHA1 Fingerprint:                  ******

    Common Name:                       www.example.com
    Issuer:                            ******
    Serial Number:                     ****
    Not Before:                        Sep 26 00:00:00 2010 GMT
    Not After:                         Sep 26 23:59:59 2020 GMT

    Signature Algorithm:               sha1WithRSAEncryption
    Key Size:                          1024 bit
    X509v3 Subject Alternative Name:   {'othername': ['<unsupported>'], 'DNS': ['www.example.com']}

* OCSP Stapling :
    Server did not send back an OCSP response.

* Session Resumption :
    With Session IDs:           Supported (5 successful, 0 failed, 0 errors, 5 total attempts).
    With TLS Session Tickets:   Supported

* SSLV2 Cipher Suites :

    Rejected Cipher Suite(s): Hidden

    Preferred Cipher Suite: None

    Accepted Cipher Suite(s): None

    Undefined - An unexpected error happened: None

* SSLV3 Cipher Suites :

    Rejected Cipher Suite(s): Hidden

    Preferred Cipher Suite:
      RC4-SHA                       128 bits      HTTP 200 OK

    Accepted Cipher Suite(s):
      CAMELLIA256-SHA               256 bits      HTTP 200 OK
      RC4-SHA                       128 bits      HTTP 200 OK
      CAMELLIA128-SHA               128 bits      HTTP 200 OK

    Undefined - An unexpected error happened: None

* TLSV1_1 Cipher Suites :

    Rejected Cipher Suite(s): Hidden

    Preferred Cipher Suite: None

    Accepted Cipher Suite(s): None

    Undefined - An unexpected error happened:
      ECDH-RSA-AES256-SHA             socket.timeout - timed out
      ECDH-ECDSA-AES256-SHA           socket.timeout - timed out

* TLSV1_2 Cipher Suites :

    Rejected Cipher Suite(s): Hidden

    Preferred Cipher Suite: None

    Accepted Cipher Suite(s): None

    Undefined - An unexpected error happened:
      ECDH-RSA-AES256-GCM-SHA384      socket.timeout - timed out
      ECDH-ECDSA-AES256-GCM-SHA384    socket.timeout - timed out

* TLSV1 Cipher Suites :

    Rejected Cipher Suite(s): Hidden

    Preferred Cipher Suite:
      RC4-SHA                       128 bits      Timeout on HTTP GET

    Accepted Cipher Suite(s):
      CAMELLIA256-SHA               256 bits      HTTP 200 OK
      RC4-SHA                       128 bits      HTTP 200 OK
      CAMELLIA128-SHA               128 bits      HTTP 200 OK

    Undefined - An unexpected error happened:
      ADH-CAMELLIA256-SHA             socket.timeout - timed out



SCAN COMPLETED IN 9.68 S
------------------------
```

## Prueba de SSL/TLS con testssl.sh

[Testssl.sh](https://github.com/drwetter/testssl.sh) es un script de shell de Linux que proporciona una salida clara para facilitar una buena toma de decisiones. No solo puede verificar servidores web sino también servicios en otros puertos, es compatible con STARTTLS, SNI, SPDY y también realiza algunas verificaciones en el encabezado HTTP.

```bash
testssl.sh owasp.org
```

resultado:

```bash
########################################################
testssl.sh v2.0rc3  (https://testssl.sh)
($Id: testssl.sh,v 1.97 2014/04/15 21:54:29 dirkw Exp $)

   This program is free software. Redistribution +
   modification under GPLv2 is permitted.
   USAGE w/o ANY WARRANTY. USE IT AT YOUR OWN RISK!

 Note you can only check the server against what is
 available (ciphers/protocols) locally on your machine
########################################################

Using "OpenSSL 1.0.2-beta1 24 Feb 2014" on
      "myhost:/<mypath>/bin/openssl64"


Testing now (2014-04-17 15:06) ---> owasp.org:443 <---
("owasp.org" resolves to "192.237.166.62 / 2001:4801:7821:77:cd2c:d9de:ff10:170e")


--> Testing Protocols

 SSLv2     NOT offered (ok)
 SSLv3     offered
 TLSv1     offered (ok)
 TLSv1.1   offered (ok)
 TLSv1.2   offered (ok)

 SPDY/NPN  not offered

--> Testing standard cipher lists

 Null Cipher              NOT offered (ok)
 Anonymous NULL Cipher    NOT offered (ok)
 Anonymous DH Cipher      NOT offered (ok)
 40 Bit encryption        NOT offered (ok)
 56 Bit encryption        NOT offered (ok)
 Export Cipher (general)  NOT offered (ok)
 Low (<=64 Bit)           NOT offered (ok)
 DES Cipher               NOT offered (ok)
 Triple DES Cipher        offered
 Medium grade encryption  offered
 High grade encryption    offered (ok)

--> Testing server defaults (Server Hello)

 Negotiated protocol       TLSv1.2
 Negotiated cipher         AES128-GCM-SHA256

 Server key size           2048 bit
 TLS server extensions:    server name, renegotiation info, session ticket, heartbeat
 Session Tickets RFC 5077  300 seconds

--> Testing specific vulnerabilities

 Heartbleed (CVE-2014-0160), experimental  NOT vulnerable (ok)
 Renegotiation (CVE 2009-3555)             NOT vulnerable (ok)
 CRIME, TLS (CVE-2012-4929)                NOT vulnerable (ok)  

--> Checking RC4 Ciphers

RC4 seems generally available. Now testing specific ciphers...

 Hexcode    Cipher Name                   KeyExch.  Encryption Bits
--------------------------------------------------------------------
 [0x05]     RC4-SHA                       RSA         RC4      128

RC4 is kind of broken, for e.g. IE6 consider 0x13 or 0x0a

--> Testing HTTP Header response

 HSTS        no
 Server      Apache
 Application (None)

--> Testing (Perfect) Forward Secrecy  (P)FS)

no PFS available

Done now (2014-04-17 15:07) ---> owasp.org:443 <---
```

probar STARTTLS:

```bash
testssl.sh -t smtp.gmail.com:587 smtp
```

probar cada cifrado:

```bash
testssl -e <target>
```

probar cada cifrado por protocolo:

```bash
testssl -E <target>
```

Para mostrar qué cifrados locales están instalados para OpenSSL

```bash
testssl -V
```

## Prueba de SSL/TLS con SSL Breacher

[SSL Breacher](http://bl0g.yehg.net/2014/07/ssl-breacher-yet-another-ssl-test-tool.html) es una combinación de varias otras herramientas más algunas verificaciones adicionales para complementar las pruebas SSL más completas. Admite las siguientes comprobaciones:

1.  HeartBleed
2.  Inyección ChangeCipherSpec
3.  INCUMPLIMIENTO
4.  BESTIA
5.  Compatibilidad con el secreto de reenvío
6.  Soporte RC4
7.  CRIME & TIME (Si se detecta CRIME, también se informará TIME)
8.  suerte13
9.  HSTS: compruebe la implementación del encabezado HSTS
10.  HSTS: duración razonable de MAX-AGE
11.  HSTS: busque soporte para subdominios
12.  Caducidad del certificado
13.  Longitud de clave pública insuficiente
14.  Discrepancia de nombre de host
15.  Algoritmo hash débil/inseguro (MD2, MD4, MD5, SHA1)
16.  Compatibilidad con SSLv2
17.  Comprobación de cifrados débiles (bajo, anónimo, nulo, exportación)
18.  Prefijo nulo en el certificado
19.  Eliminación de HTTPS
20.  Levantamiento de surf
21.  Elementos/contenidos no SSL incrustados en la página SSL
22.  Control de caché

```bash
breacher.sh https://localhost/login.php
```

resultado:

```bash
Host Info:
==============
Host : localhost
Port : 443
Path : /login.php



Certificate Info:
==================
Type: Domain Validation Certificate (i.e. NON-Extended Validation Certificate)
Expiration Date: Sat Nov 09 07:48:47 SGT 2019
Signature Hash Algorithm: SHA1withRSA
Public key: Sun RSA public key, 1024 bits
  modulus: 135632964843555009910164098161004086259135236815846778903941582882908611097021488277565732851712895057227849656364886898196239901879569635659861770850920241178222686670162318147175328086853962427921575656093414000691131757099663322369656756090030190369923050306668778534926124693591013220754558036175189121517
  public exponent: 65537
Signed for: CN=localhost
Signed by: CN=localhost
Total certificate chain: 1

(Use -Djavax.net.debug=ssl:handshake:verbose for debugged output.)

=====================================

Certificate Validation:
===============================
[!] Signed using Insufficient public key length 1024 bits
    (Refer to http://www.keylength.com/ for details)
[!] Certificate Signer: Self-signed/Untrusted CA  - verified with Firefox & Java ROOT CAs.

=====================================

Loading module: Hut3 Cardiac Arrest ...

Checking localhost:443 for Heartbleed bug (CVE-2014-0160) ...

[-] Connecting to 127.0.0.1:443 using SSLv3
[-] Sending ClientHello
[-] ServerHello received
[-] Sending Heartbeat
[Vulnerable] Heartbeat response was 16384 bytes instead of 3! 127.0.0.1:443 is vulnerable over SSLv3
[-] Displaying response (lines consisting entirely of null bytes are removed):

  0000: 02 FF FF 08 03 00 53 48 73 F0 7C CA C1 D9 02 04  ......SHs.|.....
  0010: F2 1D 2D 49 F5 12 BF 40 1B 94 D9 93 E4 C4 F4 F0  ..-I...@........
  0020: D0 42 CD 44 A2 59 00 02 96 00 00 00 01 00 02 00  .B.D.Y..........
  0060: 1B 00 1C 00 1D 00 1E 00 1F 00 20 00 21 00 22 00  .......... .!.".
  0070: 23 00 24 00 25 00 26 00 27 00 28 00 29 00 2A 00  #.$.%.&.'.(.).*.
  0080: 2B 00 2C 00 2D 00 2E 00 2F 00 30 00 31 00 32 00  +.,.-.../.0.1.2.
  0090: 33 00 34 00 35 00 36 00 37 00 38 00 39 00 3A 00  3.4.5.6.7.8.9.:.
  00a0: 3B 00 3C 00 3D 00 3E 00 3F 00 40 00 41 00 42 00  ;.<.=.>.?.@.A.B.
  00b0: 43 00 44 00 45 00 46 00 60 00 61 00 62 00 63 00  C.D.E.F.`.a.b.c.
  00c0: 64 00 65 00 66 00 67 00 68 00 69 00 6A 00 6B 00  d.e.f.g.h.i.j.k.
  00d0: 6C 00 6D 00 80 00 81 00 82 00 83 00 84 00 85 00  l.m.............
  01a0: 20 C0 21 C0 22 C0 23 C0 24 C0 25 C0 26 C0 27 C0   .!.".#.$.%.&.'.
  01b0: 28 C0 29 C0 2A C0 2B C0 2C C0 2D C0 2E C0 2F C0  (.).*.+.,.-.../.
  01c0: 30 C0 31 C0 32 C0 33 C0 34 C0 35 C0 36 C0 37 C0  0.1.2.3.4.5.6.7.
  01d0: 38 C0 39 C0 3A C0 3B C0 3C C0 3D C0 3E C0 3F C0  8.9.:.;.<.=.>.?.
  01e0: 40 C0 41 C0 42 C0 43 C0 44 C0 45 C0 46 C0 47 C0  @.A.B.C.D.E.F.G.
  01f0: 48 C0 49 C0 4A C0 4B C0 4C C0 4D C0 4E C0 4F C0  H.I.J.K.L.M.N.O.
  0200: 50 C0 51 C0 52 C0 53 C0 54 C0 55 C0 56 C0 57 C0  P.Q.R.S.T.U.V.W.
  0210: 58 C0 59 C0 5A C0 5B C0 5C C0 5D C0 5E C0 5F C0  X.Y.Z.[.\.].^._.
  0220: 60 C0 61 C0 62 C0 63 C0 64 C0 65 C0 66 C0 67 C0  `.a.b.c.d.e.f.g.
  0230: 68 C0 69 C0 6A C0 6B C0 6C C0 6D C0 6E C0 6F C0  h.i.j.k.l.m.n.o.
  0240: 70 C0 71 C0 72 C0 73 C0 74 C0 75 C0 76 C0 77 C0  p.q.r.s.t.u.v.w.
  0250: 78 C0 79 C0 7A C0 7B C0 7C C0 7D C0 7E C0 7F C0  x.y.z.{.|.}.~...
  02c0: 00 00 49 00 0B 00 04 03 00 01 02 00 0A 00 34 00  ..I...........4.
  02d0: 32 00 0E 00 0D 00 19 00 0B 00 0C 00 18 00 09 00  2...............
  0300: 10 00 11 00 23 00 00 00 0F 00 01 01 00 00 00 00  ....#...........
  0bd0: 00 00 00 00 00 00 00 00 00 12 7D 01 00 10 00 02  ..........}.....

[-] Closing connection

[-] Connecting to 127.0.0.1:443 using TLSv1.0
[-] Sending ClientHello
[-] ServerHello received
[-] Sending Heartbeat
[Vulnerable] Heartbeat response was 16384 bytes instead of 3! 127.0.0.1:443 is vulnerable over TLSv1.0
[-] Displaying response (lines consisting entirely of null bytes are removed):

  0000: 02 FF FF 08 03 01 53 48 73 F0 7C CA C1 D9 02 04  ......SHs.|.....
  0010: F2 1D 2D 49 F5 12 BF 40 1B 94 D9 93 E4 C4 F4 F0  ..-I...@........
  0020: D0 42 CD 44 A2 59 00 02 96 00 00 00 01 00 02 00  .B.D.Y..........
  0060: 1B 00 1C 00 1D 00 1E 00 1F 00 20 00 21 00 22 00  .......... .!.".
  0070: 23 00 24 00 25 00 26 00 27 00 28 00 29 00 2A 00  #.$.%.&.'.(.).*.
  0080: 2B 00 2C 00 2D 00 2E 00 2F 00 30 00 31 00 32 00  +.,.-.../.0.1.2.
  0090: 33 00 34 00 35 00 36 00 37 00 38 00 39 00 3A 00  3.4.5.6.7.8.9.:.
  00a0: 3B 00 3C 00 3D 00 3E 00 3F 00 40 00 41 00 42 00  ;.<.=.>.?.@.A.B.
  00b0: 43 00 44 00 45 00 46 00 60 00 61 00 62 00 63 00  C.D.E.F.`.a.b.c.
  00c0: 64 00 65 00 66 00 67 00 68 00 69 00 6A 00 6B 00  d.e.f.g.h.i.j.k.
  00d0: 6C 00 6D 00 80 00 81 00 82 00 83 00 84 00 85 00  l.m.............
  01a0: 20 C0 21 C0 22 C0 23 C0 24 C0 25 C0 26 C0 27 C0   .!.".#.$.%.&.'.
  01b0: 28 C0 29 C0 2A C0 2B C0 2C C0 2D C0 2E C0 2F C0  (.).*.+.,.-.../.
  01c0: 30 C0 31 C0 32 C0 33 C0 34 C0 35 C0 36 C0 37 C0  0.1.2.3.4.5.6.7.
  01d0: 38 C0 39 C0 3A C0 3B C0 3C C0 3D C0 3E C0 3F C0  8.9.:.;.<.=.>.?.
  01e0: 40 C0 41 C0 42 C0 43 C0 44 C0 45 C0 46 C0 47 C0  @.A.B.C.D.E.F.G.
  01f0: 48 C0 49 C0 4A C0 4B C0 4C C0 4D C0 4E C0 4F C0  H.I.J.K.L.M.N.O.
  0200: 50 C0 51 C0 52 C0 53 C0 54 C0 55 C0 56 C0 57 C0  P.Q.R.S.T.U.V.W.
  0210: 58 C0 59 C0 5A C0 5B C0 5C C0 5D C0 5E C0 5F C0  X.Y.Z.[.\.].^._.
  0220: 60 C0 61 C0 62 C0 63 C0 64 C0 65 C0 66 C0 67 C0  `.a.b.c.d.e.f.g.
  0230: 68 C0 69 C0 6A C0 6B C0 6C C0 6D C0 6E C0 6F C0  h.i.j.k.l.m.n.o.
  0240: 70 C0 71 C0 72 C0 73 C0 74 C0 75 C0 76 C0 77 C0  p.q.r.s.t.u.v.w.
  0250: 78 C0 79 C0 7A C0 7B C0 7C C0 7D C0 7E C0 7F C0  x.y.z.{.|.}.~...
  02c0: 00 00 49 00 0B 00 04 03 00 01 02 00 0A 00 34 00  ..I...........4.
  02d0: 32 00 0E 00 0D 00 19 00 0B 00 0C 00 18 00 09 00  2...............
  0300: 10 00 11 00 23 00 00 00 0F 00 01 01 00 00 00 00  ....#...........
  0bd0: 00 00 00 00 00 00 00 00 00 12 7D 01 00 10 00 02  ..........}.....

[-] Closing connection

[-] Connecting to 127.0.0.1:443 using TLSv1.1
[-] Sending ClientHello
[-] ServerHello received
[-] Sending Heartbeat
[Vulnerable] Heartbeat response was 16384 bytes instead of 3! 127.0.0.1:443 is vulnerable over TLSv1.1
[-] Displaying response (lines consisting entirely of null bytes are removed):

  0000: 02 FF FF 08 03 02 53 48 73 F0 7C CA C1 D9 02 04  ......SHs.|.....
  0010: F2 1D 2D 49 F5 12 BF 40 1B 94 D9 93 E4 C4 F4 F0  ..-I...@........
  0020: D0 42 CD 44 A2 59 00 02 96 00 00 00 01 00 02 00  .B.D.Y..........
  0060: 1B 00 1C 00 1D 00 1E 00 1F 00 20 00 21 00 22 00  .......... .!.".
  0070: 23 00 24 00 25 00 26 00 27 00 28 00 29 00 2A 00  #.$.%.&.'.(.).*.
  0080: 2B 00 2C 00 2D 00 2E 00 2F 00 30 00 31 00 32 00  +.,.-.../.0.1.2.
  0090: 33 00 34 00 35 00 36 00 37 00 38 00 39 00 3A 00  3.4.5.6.7.8.9.:.
  00a0: 3B 00 3C 00 3D 00 3E 00 3F 00 40 00 41 00 42 00  ;.<.=.>.?.@.A.B.
  00b0: 43 00 44 00 45 00 46 00 60 00 61 00 62 00 63 00  C.D.E.F.`.a.b.c.
  00c0: 64 00 65 00 66 00 67 00 68 00 69 00 6A 00 6B 00  d.e.f.g.h.i.j.k.
  00d0: 6C 00 6D 00 80 00 81 00 82 00 83 00 84 00 85 00  l.m.............
  01a0: 20 C0 21 C0 22 C0 23 C0 24 C0 25 C0 26 C0 27 C0   .!.".#.$.%.&.'.
  01b0: 28 C0 29 C0 2A C0 2B C0 2C C0 2D C0 2E C0 2F C0  (.).*.+.,.-.../.
  01c0: 30 C0 31 C0 32 C0 33 C0 34 C0 35 C0 36 C0 37 C0  0.1.2.3.4.5.6.7.
  01d0: 38 C0 39 C0 3A C0 3B C0 3C C0 3D C0 3E C0 3F C0  8.9.:.;.<.=.>.?.
  01e0: 40 C0 41 C0 42 C0 43 C0 44 C0 45 C0 46 C0 47 C0  @.A.B.C.D.E.F.G.
  01f0: 48 C0 49 C0 4A C0 4B C0 4C C0 4D C0 4E C0 4F C0  H.I.J.K.L.M.N.O.
  0200: 50 C0 51 C0 52 C0 53 C0 54 C0 55 C0 56 C0 57 C0  P.Q.R.S.T.U.V.W.
  0210: 58 C0 59 C0 5A C0 5B C0 5C C0 5D C0 5E C0 5F C0  X.Y.Z.[.\.].^._.
  0220: 60 C0 61 C0 62 C0 63 C0 64 C0 65 C0 66 C0 67 C0  `.a.b.c.d.e.f.g.
  0230: 68 C0 69 C0 6A C0 6B C0 6C C0 6D C0 6E C0 6F C0  h.i.j.k.l.m.n.o.
  0240: 70 C0 71 C0 72 C0 73 C0 74 C0 75 C0 76 C0 77 C0  p.q.r.s.t.u.v.w.
  0250: 78 C0 79 C0 7A C0 7B C0 7C C0 7D C0 7E C0 7F C0  x.y.z.{.|.}.~...
  02c0: 00 00 49 00 0B 00 04 03 00 01 02 00 0A 00 34 00  ..I...........4.
  02d0: 32 00 0E 00 0D 00 19 00 0B 00 0C 00 18 00 09 00  2...............
  0300: 10 00 11 00 23 00 00 00 0F 00 01 01 00 00 00 00  ....#...........
  0bd0: 00 00 00 00 00 00 00 00 00 12 7D 01 00 10 00 02  ..........}.....

[-] Closing connection

[-] Connecting to 127.0.0.1:443 using TLSv1.2
[-] Sending ClientHello
[-] ServerHello received
[-] Sending Heartbeat
[Vulnerable] Heartbeat response was 16384 bytes instead of 3! 127.0.0.1:443 is vulnerable over TLSv1.2
[-] Displaying response (lines consisting entirely of null bytes are removed):

  0000: 02 FF FF 08 03 03 53 48 73 F0 7C CA C1 D9 02 04  ......SHs.|.....
  0010: F2 1D 2D 49 F5 12 BF 40 1B 94 D9 93 E4 C4 F4 F0  ..-I...@........
  0020: D0 42 CD 44 A2 59 00 02 96 00 00 00 01 00 02 00  .B.D.Y..........
  0060: 1B 00 1C 00 1D 00 1E 00 1F 00 20 00 21 00 22 00  .......... .!.".
  0070: 23 00 24 00 25 00 26 00 27 00 28 00 29 00 2A 00  #.$.%.&.'.(.).*.
  0080: 2B 00 2C 00 2D 00 2E 00 2F 00 30 00 31 00 32 00  +.,.-.../.0.1.2.
  0090: 33 00 34 00 35 00 36 00 37 00 38 00 39 00 3A 00  3.4.5.6.7.8.9.:.
  00a0: 3B 00 3C 00 3D 00 3E 00 3F 00 40 00 41 00 42 00  ;.<.=.>.?.@.A.B.
  00b0: 43 00 44 00 45 00 46 00 60 00 61 00 62 00 63 00  C.D.E.F.`.a.b.c.
  00c0: 64 00 65 00 66 00 67 00 68 00 69 00 6A 00 6B 00  d.e.f.g.h.i.j.k.
  00d0: 6C 00 6D 00 80 00 81 00 82 00 83 00 84 00 85 00  l.m.............
  01a0: 20 C0 21 C0 22 C0 23 C0 24 C0 25 C0 26 C0 27 C0   .!.".#.$.%.&.'.
  01b0: 28 C0 29 C0 2A C0 2B C0 2C C0 2D C0 2E C0 2F C0  (.).*.+.,.-.../.
  01c0: 30 C0 31 C0 32 C0 33 C0 34 C0 35 C0 36 C0 37 C0  0.1.2.3.4.5.6.7.
  01d0: 38 C0 39 C0 3A C0 3B C0 3C C0 3D C0 3E C0 3F C0  8.9.:.;.<.=.>.?.
  01e0: 40 C0 41 C0 42 C0 43 C0 44 C0 45 C0 46 C0 47 C0  @.A.B.C.D.E.F.G.
  01f0: 48 C0 49 C0 4A C0 4B C0 4C C0 4D C0 4E C0 4F C0  H.I.J.K.L.M.N.O.
  0200: 50 C0 51 C0 52 C0 53 C0 54 C0 55 C0 56 C0 57 C0  P.Q.R.S.T.U.V.W.
  0210: 58 C0 59 C0 5A C0 5B C0 5C C0 5D C0 5E C0 5F C0  X.Y.Z.[.\.].^._.
  0220: 60 C0 61 C0 62 C0 63 C0 64 C0 65 C0 66 C0 67 C0  `.a.b.c.d.e.f.g.
  0230: 68 C0 69 C0 6A C0 6B C0 6C C0 6D C0 6E C0 6F C0  h.i.j.k.l.m.n.o.
  0240: 70 C0 71 C0 72 C0 73 C0 74 C0 75 C0 76 C0 77 C0  p.q.r.s.t.u.v.w.
  0250: 78 C0 79 C0 7A C0 7B C0 7C C0 7D C0 7E C0 7F C0  x.y.z.{.|.}.~...
  02c0: 00 00 49 00 0B 00 04 03 00 01 02 00 0A 00 34 00  ..I...........4.
  02d0: 32 00 0E 00 0D 00 19 00 0B 00 0C 00 18 00 09 00  2...............
  0300: 10 00 11 00 23 00 00 00 0F 00 01 01 00 00 00 00  ....#...........
  0bd0: 00 00 00 00 00 00 00 00 00 12 7D 01 00 10 00 02  ..........}.....

[-] Closing connection



[!] Vulnerable to Heartbleed bug (CVE-2014-0160) mentioned in http://heartbleed.com/
[!] Vulnerability Status: VULNERABLE


=====================================

Loading module: CCS Injection script by TripWire VERT ...

Checking localhost:443 for OpenSSL ChangeCipherSpec (CCS) Injection bug (CVE-2014-0224) ...

[!] The target may allow early CCS on TLSv1.2
[!] The target may allow early CCS on TLSv1.1
[!] The target may allow early CCS on TLSv1
[!] The target may allow early CCS on SSLv3


[-] This is an experimental detection script and does not definitively determine vulnerable server status.

[!] Potentially vulnerable to OpenSSL ChangeCipherSpec (CCS) Injection vulnerability (CVE-2014-0224) mentioned in http://ccsinjection.lepidum.co.jp/
[!] Vulnerability Status: Possible


=====================================

Checking localhost:443 for HTTP Compression support against BREACH vulnerability (CVE-2013-3587) ...

[*] HTTP Compression: DISABLED
[*] Immune from BREACH attack mentioned in https://media.blackhat.com/us-13/US-13-Prado-SSL-Gone-in-30-seconds-A-BREACH-beyond-CRIME-WP.pdf
[*] Vulnerability Status: No


--------------- RAW HTTP RESPONSE ---------------

HTTP/1.1 200 OK
Date: Wed, 23 Jul 2014 13:48:07 GMT
Server: Apache/2.4.3 (Win32) OpenSSL/1.0.1c PHP/5.4.7
X-Powered-By: PHP/5.4.7
Set-Cookie: SessionID=xxx; expires=Wed, 23-Jul-2014 12:48:07 GMT; path=/; secure
Set-Cookie: SessionChallenge=yyy; expires=Wed, 23-Jul-2014 12:48:07 GMT; path=/
Content-Length: 193
Connection: close
Content-Type: text/html

<html>
<head>
<title>Login page </title>
</head>
<body>
<script src="http://othersite/test.js"></script>

<link rel="stylesheet" type="text/css" href="http://somesite/test.css">


=====================================

Checking localhost:443 for correct use of Strict Transport Security (STS) response header (RFC6797) ...

[!] STS response header: NOT PRESENT
[!] Vulnerable to MITM threats mentioned in https://www.owasp.org/index.php/HTTP_Strict_Transport_Security#Threats
[!] Vulnerability Status: VULNERABLE


--------------- RAW HTTP RESPONSE ---------------

HTTP/1.1 200 OK
Date: Wed, 23 Jul 2014 13:48:07 GMT
Server: Apache/2.4.3 (Win32) OpenSSL/1.0.1c PHP/5.4.7
X-Powered-By: PHP/5.4.7
Set-Cookie: SessionID=xxx; expires=Wed, 23-Jul-2014 12:48:07 GMT; path=/; secure
Set-Cookie: SessionChallenge=yyy; expires=Wed, 23-Jul-2014 12:48:07 GMT; path=/
Content-Length: 193
Connection: close
Content-Type: text/html

<html>
<head>
<title>Login page </title>
</head>
<body>
<script src="http://othersite/test.js"></script>

<link rel="stylesheet" type="text/css" href="http://somesite/test.css">


=====================================

Checking localhost for HTTP support against HTTPS Stripping attack ...

[!] HTTP Support on port [80] : SUPPORTED
[!] Vulnerable to HTTPS Stripping attack mentioned in https://www.blackhat.com/presentations/bh-dc-09/Marlinspike/BlackHat-DC-09-Marlinspike-Defeating-SSL.pdf
[!] Vulnerability Status: VULNERABLE


=====================================

Checking localhost:443 for HTTP elements embedded in SSL page ...

[!] HTTP elements embedded in SSL page: PRESENT
[!] Vulnerable to MITM malicious content injection attack
[!] Vulnerability Status: VULNERABLE


--------------- HTTP RESOURCES EMBEDDED ---------------
 - http://othersite/test.js
 - http://somesite/test.css

=====================================

Checking localhost:443 for ROBUST use of anti-caching mechanism ...

[!] Cache Control Directives: NOT PRESENT
[!] Browsers, Proxies and other Intermediaries will cache SSL page and sensitive information will be leaked.
[!] Vulnerability Status: VULNERABLE


-------------------------------------------------

Robust Solution:

    - Cache-Control: no-cache, no-store, must-revalidate, pre-check=0, post-check=0, max-age=0, s-maxage=0
    - Ref: https://wiki.owasp.org/index.php/Testing_for_Browser_cache_weakness_(OTG-AUTHN-006)
           https://docs.microsoft.com/en-us/iis/configuration/system.webserver/staticcontent/clientcache

=====================================

Checking localhost:443 for Surf Jacking vulnerability (due to Session Cookie missing secure flag) ...

[!] Secure Flag in Set-Cookie:  PRESENT BUT NOT IN ALL COOKIES
[!] Vulnerable to Surf Jacking attack mentioned in https://resources.enablesecurity.com/resources/Surf%20Jacking.pdf
[!] Vulnerability Status: VULNERABLE

--------------- RAW HTTP RESPONSE ---------------

HTTP/1.1 200 OK
Date: Wed, 23 Jul 2014 13:48:07 GMT
Server: Apache/2.4.3 (Win32) OpenSSL/1.0.1c PHP/5.4.7
X-Powered-By: PHP/5.4.7
Set-Cookie: SessionID=xxx; expires=Wed, 23-Jul-2014 12:48:07 GMT; path=/; secure
Set-Cookie: SessionChallenge=yyy; expires=Wed, 23-Jul-2014 12:48:07 GMT; path=/
Content-Length: 193
Connection: close
Content-Type: text/html

=====================================

Checking localhost:443 for ECDHE/DHE ciphers against FORWARD SECRECY support ...

[*] Forward Secrecy: SUPPORTED
[*] Connected using cipher - TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA on protocol - TLSv1
[*] Attackers will NOT be able to decrypt sniffed SSL packets even if they have compromised private keys.
[*] Vulnerability Status: No

=====================================

Checking localhost:443 for RC4 support (CVE-2013-2566) ...

[!] RC4: SUPPORTED
[!] Vulnerable to MITM attack described in http://www.isg.rhul.ac.uk/tls/
[!] Vulnerability Status: VULNERABLE



=====================================

Checking localhost:443 for TLS 1.1 support ...

Checking localhost:443 for TLS 1.2 support ...

[*] TLS 1.1, TLS 1.2: SUPPORTED
[*] Immune from BEAST attack mentioned in https://www.infoworld.com/article/2620383/red-alert--https-has-been-hacked.html
[*] Vulnerability Status: No



=====================================

Loading module: sslyze by iSecPartners ...

Checking localhost:443 for Session Renegotiation support (CVE-2009-3555,CVE-2011-1473,CVE-2011-5094) ...

[*] Secure Client-Initiated Renegotiation : NOT SUPPORTED
[*] Mitigated from DOS attack (CVE-2011-1473,CVE-2011-5094) mentioned in https://www.thc.org/thc-ssl-dos/
[*] Vulnerability Status: No


[*] INSECURE Client-Initiated Renegotiation : NOT SUPPORTED
[*] Immune from TLS Plain-text Injection attack (CVE-2009-3555) - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3555  
[*] Vulnerability Status: No


=====================================

Loading module: TestSSLServer by Thomas Pornin ...

Checking localhost:443 for SSL version 2 support ...

[*] SSL version 2 : NOT SUPPORTED
[*] Immune from SSLv2-based MITM attack
[*] Vulnerability Status: No


=====================================

Checking localhost:443 for LANE (LOW,ANON,NULL,EXPORT) weak ciphers support ...

Supported LANE cipher suites:
  SSLv3
     RSA_EXPORT_WITH_RC4_40_MD5
     RSA_EXPORT_WITH_RC2_CBC_40_MD5
     RSA_EXPORT_WITH_DES40_CBC_SHA
     RSA_WITH_DES_CBC_SHA
     DHE_RSA_EXPORT_WITH_DES40_CBC_SHA
     DHE_RSA_WITH_DES_CBC_SHA
     TLS_ECDH_anon_WITH_RC4_128_SHA
     TLS_ECDH_anon_WITH_3DES_EDE_CBC_SHA
     TLS_ECDH_anon_WITH_AES_256_CBC_SHA
  (TLSv1.0: same as above)
  (TLSv1.1: same as above)
  (TLSv1.2: same as above)


[!] LANE ciphers : SUPPORTED
[!] Attackers may be ABLE to recover encrypted packets.
[!] Vulnerability Status: VULNERABLE


=====================================

Checking localhost:443 for GCM/CCM ciphers support against Lucky13 attack (CVE-2013-0169) ...

Supported GCM cipher suites against Lucky13 attack:
  TLSv1.2
     TLS_RSA_WITH_AES_128_GCM_SHA256
     TLS_RSA_WITH_AES_256_GCM_SHA384
     TLS_DHE_RSA_WITH_AES_128_GCM_SHA256
     TLS_DHE_RSA_WITH_AES_256_GCM_SHA384
     TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
     TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384


[*] GCM/CCM ciphers : SUPPORTED
[*] Immune from Lucky13 attack mentioned in http://www.isg.rhul.ac.uk/tls/Lucky13.html
[*] Vulnerability Status: No


=====================================

Checking localhost:443 for TLS Compression support against CRIME (CVE-2012-4929) & TIME attack  ...

[*] TLS Compression : DISABLED
[*] Immune from CRIME & TIME attack mentioned in https://media.blackhat.com/eu-13/briefings/Beery/bh-eu-13-a-perfect-crime-beery-wp.pdf
[*] Vulnerability Status: No


=====================================

[+] Breacher finished scanning in 12 seconds.
[+] Get your latest copy at http://yehg.net/
```

## Prueba de O-Saft - Herramienta forense avanzada OWASP SSL

[O-Saft](https://github.com/OWASP/O-Saft) es la prueba SSL más completa. Admite las siguientes comprobaciones:

1.  BESTIA
2.  INCUMPLIMIENTO
3.  CRIMEN
4.  FENÓMENO
5.  HeartBleed
6.  HORA
7.  PFS: Compatibilidad con confidencialidad hacia adelante
8.  HSTS: compruebe la implementación del encabezado HSTS
9.  Soporte SNI
10.  Certificado: discrepancia de nombre de host
11.  Caducidad del certificado
12.  Extensión de certificado
13.  Algoritmo hash débil/inseguro (MD2, MD4, MD5, SHA1)
14.  Compatibilidad con SSLv2, SSLv3
15.  Comprobación de cifrados débiles (bajo, anónimo, nulo, exportación)
16.  Soporte RC4
17.  Comprueba cualquier cifrado independiente de SSL libriray
18.  admite conexiones proxy
19.  protocolos compatibles: HTTPS, SMTP, POP3, IMAP, LDAP, RDP, XMPP, IRC

## Explotación del navegador contra el ataque SSL/TLS (BEAST)

El ataque _Browser Exploit Against SSL/TLS (BEAST)_ se reveló en septiembre de 2011. Se aplica a SSL 3.0 y TLS 1.0, por lo que afecta a los navegadores que admiten TLS 1.0 o protocolos anteriores. Un atacante puede descifrar los datos intercambiados entre dos partes aprovechando una vulnerabilidad en la implementación del modo Cipher Block Chaining (CBC) en TLS 1.0. La vulnerabilidad BEAST está registrada en la base de datos NIST NVD como [CVE-2011-3389](https://nvd.nist.gov/vuln/detail/CVE-2011-3389) .



### Requisitos previos para que funcione el ataque BEAST:

1.  El servidor web habilitado para SSL debe ejecutar la versión de SSL 3.0 o inferior o TLS 1.0.
2.  Debe admitir cifrados en bloque CBC.
3.  El atacante debe poder mezclar su contenido con el contenido SSL.
4.  El atacante debe implementar un Man-in-the-middle (MITM) para poder observar el tráfico SSL. Aunque, no podrá descifrar el contenido dentro.
5.  El ataque solo funciona en cifrados de bloque como AES, DES solamente. Los cifrados de flujo no se ven afectados por ello.

## POC

```bash
# TLSv1.0 and CBC ciphers
openssl s_client -[sslv3/tls1] -cipher CBC_CIPHER -connect example.com:443
```

[https://github.com/mpgn/BEAST-PoC](https://github.com/mpgn/BEAST-PoC)

### Mitigaciones para el ataque BEAST:

El ataque BEAST se puede prevenir de las siguientes maneras:

1.  Usando TLS 1.1 o TLS 1.2. **_(Muy recomendado)_**
2.  Si usa una versión inferior de TLS o si el servidor usa SSL, use un cifrado de flujo como RC4.

BEAST es realmente una forma ingeniosa de aprovechar el ataque Chosen Plaintext para debilitar el protocolo SSL/TLS.

**FUENTE: [https://medium.com/@c0D3M/beast-attack-explained-f272acd7996e](https://medium.com/@c0D3M/beast-attack-explained-f272acd7996e)**

## POODLE ATTACK

POODLE significa (" [Padding Oracle](https://en.wikipedia.org/wiki/Padding_oracle_attack) On Downgraded Legacy Encryption"). En esta vulnerabilidad, un atacante que es Man-in-the-Middle (MiTM) primero:

-   Rebaje la conexión TLS a **SSLv3** .
-   Luego, si el conjunto de cifrado usa RC4 o Block cipher en modo CBC, el atacante puede recuperar bytes parciales de texto cifrado y luego puede obtener texto sin formato completo.

se publicó en octubre de 2014 y aprovecha dos factores. El primer factor es el hecho de que algunos servidores/clientes aún admiten SSL 3.0 para la interoperabilidad y compatibilidad con sistemas heredados. El segundo factor es una vulnerabilidad que existe en SSL 3.0, que está relacionada con el relleno de bloques. La vulnerabilidad POODLE está registrada en la base de datos NIST NVD como CVE-2014-3566.

### POC

- [https://github.com/mpgn/poodle-PoC](https://github.com/mpgn/poodle-PoC)

### MITIGACION

-   Deshabilite completamente SSL 3.0 en el servidor (muy recomendable a menos que deba [admitir Internet Explorer 6.0](https://developer.microsoft.com/en-us/microsoft-edge/ie6countdown/) ).
-   Actualice el navegador (cliente) a la última versión. Si debe usar una versión anterior, deshabilite SSLv2 y SSLv3. La mayoría de los navegadores/servidores actuales usan [TLS_FALLBACK_SCSV](https://tools.ietf.org/html/rfc7507) . Si un cliente solicita una versión del protocolo TLS que es inferior a la más alta admitida por el servidor (y el cliente), el servidor lo tratará como una versión anterior intencional y desconectará la conexión.
-   Algunas implementaciones de TLS 1.0/1.1 también son vulnerables a POODLE porque aceptan una estructura de relleno incorrecta después del descifrado.

**FUENTE: 
- [https://medium.com/@c0D3M/poodle-attack-explained-ed6a1cd0667d](https://medium.com/@c0D3M/poodle-attack-explained-ed6a1cd0667d)
- [https://www.acunetix.com/blog/articles/tls-vulnerabilities-attacks-final-part/](https://www.acunetix.com/blog/articles/tls-vulnerabilities-attacks-final-part/)

## CRIME (CVE-2012-4929)

La vulnerabilidad _Compression Ratio Info-leak Made Easy (CRIME)_ afecta la compresión TLS. El método de compresión se incluye en el mensaje de _saludo del cliente y es opcional._ Puede establecer una conexión sin compresión. La compresión se introdujo en SSL/TLS para reducir el ancho de banda. _DEFLATE_ es el algoritmo de compresión más común utilizado. La vulnerabilidad CRIME está registrada en la base de datos NIST NVD como [CVE-2012-4929](https://nvd.nist.gov/vuln/detail/CVE-2012-4929) .

### POC

```bash
# Check for "Compression: NONE"
openssl s_client -connect example.com:443
```

[https://github.com/mpgn/CRIME-poc](https://github.com/mpgn/CRIME-poc)

### Remediación

CRIME se puede derrotar al evitar el uso de la compresión, ya sea en el extremo del cliente, por el navegador que deshabilita la compresión de las solicitudes HTTPS, o por el sitio web que evita el uso de la compresión de datos en tales transacciones utilizando las funciones de negociación del protocolo TLS. Como se detalla en el protocolo de seguridad de la capa de transporte (TLS), versión 1.2, el cliente envía una lista de algoritmos de compresión en su mensaje ClientHello y el servidor elige uno de ellos y lo devuelve en su mensaje ServerHello. El servidor solo puede elegir un método de compresión que haya ofrecido el cliente, por lo que si el cliente solo ofrece 'ninguno' (sin compresión), los datos no se comprimirán. Del mismo modo, dado que todos los clientes TLS deben permitir 'sin compresión', un servidor siempre puede negarse a usar la compresión.


## BREACH

La vulnerabilidad _de reconocimiento y exfiltración del navegador a través de la compresión adaptativa de hipertexto (BREACH)_ es muy similar a CRIME, pero BREACH apunta a la compresión HTTP, no a la compresión TLS. Este ataque es posible incluso si la compresión TLS está desactivada. Un atacante obliga al navegador de la víctima a conectarse a un sitio web de terceros habilitado para TLS y supervisa el tráfico entre la víctima y el servidor mediante un ataque de intermediario. La vulnerabilidad BREACH está registrada en la base de datos NIST NVD como [CVE-2013-3587](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-3587) .

Una aplicación web vulnerable debe cumplir las siguientes condiciones:

-   Ser servido desde un servidor que usa compresión de nivel HTTP
-   Reflejar la entrada del usuario en cuerpos de respuesta HTTP
-   Refleje un secreto (como un token CSRF) en los cuerpos de respuesta HTTP (por lo tanto, los valores en los encabezados HTTP, como las cookies, están a salvo de este ataque).


### POC

```bash
# If the response contains encoded data, host is vulnerable
openssl s_client -connect example.com:443
GET / HTTP/1.1
Host: example.com
Accept-Encoding: compress, gzip
```

[https://github.com/dimkarakostas/breach](https://github.com/dimkarakostas/breach)

### PREVENSION

-   Deshabilitar la compresión HTTP
-   Separe los secretos de la entrada del usuario
-   Aleatorizar secretos por solicitud
-   Enmascarar secretos (efectivamente aleatorizar mediante XORing con un secreto aleatorio por solicitud)
-   Proteger páginas contra CSRF
-   Oculte la longitud (agregando números aleatorios de bytes a las respuestas)
-   Limitar la tasa de solicitudes

## HEARTBEAT

[Heartbleed](https://www.acunetix.com/blog/articles/aftermath-heartbleed-bug/) fue una vulnerabilidad crítica que se encontró en la _extensión de latidos_ de la popular biblioteca OpenSSL. Esta extensión se utiliza para mantener viva una conexión siempre que ambas partes sigan allí. La vulnerabilidad Heartbleed está registrada en la base de datos NIST NVD como [CVE-2014-0160](https://nvd.nist.gov/vuln/detail/CVE-2014-0160) .

Heartbleed es una falla en la implementación de la extensión Heartbeat de OpenSSL. Es solo una extensión de OpenSSL que mantiene activa la sesión para conexiones HTTPS, al igual que el encabezado Keep-Alive en HTTP.

Heartbleed es un error debido a la implementación en la biblioteca OpenSSL de las versiones 1.0.1 a 1.0.1f (que es muy utilizada). Permite a un usuario acceder a la memoria en el servidor (a la que normalmente no tendría acceso). Esto, a su vez, permite que un usuario malintencionado acceda a diferentes tipos de información (a la que normalmente no tendría acceso debido al cifrado y la integridad proporcionados por TLS), que incluyen:

-   clave privada del servidor
-   datos confidenciales como nombres de usuario, contraseñas y otra información personal

Se puede enviar mucha información confidencial de la memoria del servidor a través de la respuesta. Algunos de ellos son información relacionada con la sesión, como ID de sesión, diferentes tokens, claves y alguna otra información interna sensible, como consultas, datos internos, etc.

### POC

```bash
# Heartbleed
nmap -p 443 --script ssl-heartbleed --script-args vulns.showall example.com

# Heartbleed checker oneliner from sites list
cat list.txt | while read line ; do echo "QUIT" | openssl s_client -connect $line:443 2>&1 | grep 'server extension "heartbeat" (id=15)' || echo $line: safe; done
```

```bash
searchsploit heartbleed

searchsploit -m multiple/remote/32745.py

python 32745.py 10.10.10.10 -p 443
```

### Prevención

-   Actualice a la última versión de OpenSSL. Si eso no es posible, vuelva a compilar la versión ya instalada con`-DOPENSSL_NO_HEARTBEATS`

Para asegurarse de que los datos arbitrarios del servidor no se copien y envíen a un usuario, el servidor debe verificar la longitud del mensaje de latido:

-   El servidor debe verificar que la longitud del mensaje de latido enviado por el usuario no sea 0
-   El servidor necesita verificar que la longitud no exceda la longitud especificada de la variable que contiene los datos.

## SWEET32

 El ataque apunta a las fallas de diseño en algunos cifrados. Estos cifrados se utilizan en TLS, SSH, IPsec y OpenVPN. El ataque Sweet32 permite que un atacante recupere pequeñas porciones de texto sin formato. Está cifrado con cifrados de bloque de 64 bits (como Triple-DES y Blowfish), en determinadas circunstancias (limitadas). El ataque SWEET32 se puede utilizar para explotar la comunicación que utiliza un conjunto de cifrado basado en DES/3DES. Un atacante man-in-the-middle podría usar esta falla para recuperar algunos datos de texto sin formato. El atacante puede robar grandes cantidades de tráfico cifrado entre el servidor TLS/SSL y el cliente.

El ataque SWEET32 afecta el algoritmo comúnmente utilizado como AES (Estándar de cifrado avanzado), Triple-DES (Estándar de cifrado de datos) y Blowfish para cifrar la comunicación para el protocolo TLS, SSH, IPsec y OpenVPN. Estos algoritmos dividen los datos en bloques. Como estos algoritmos generan bloques de tamaño pequeño, estos bloques serán vulnerables a los ataques de cumpleaños. Debido a una falla en el algoritmo, habrá una situación en la que dos bloques tengan la misma clave. Un atacante puede acceder a la información mediante la operación XOR en los bloques para revelar el texto sin formato.

### POC

```bash
openssl s_client -cipher 3DES -connect example.com:443
```

### MITIGACION

-   Utilice la actualización de seguridad de OpenSSL RHSA-2016:1940.
-   Intente evitar el uso de cifrados de bloque heredados de 64 bits.
-   Los servidores y la VPN deben usar cifrados de 128 bits para el cifrado.

## LUCKY13

El ataque **Lucky Thirteen** es un ataque de tiempo criptográfico contra implementaciones del protocolo _Transport Layer Security_ (**TLS**), explota un problema de diseño de este protocolo y permite obtener información en texto plano a partir de un texto cifrado.  
  
El nombre proviene del hecho de que los paquetes TLS cifrados tienen trece bytes de encabezado que se consumen en uno de los cálculos criptográficos en los que se basa TLS.  
  
El nombre de esta técnica roza la ironía, ya que en cierto sentido, el número trece es de la mala (o buena) suerte. Sin embargo, cuando se pone en práctica el ataque, “_Lucky Twelve_” sería un nombre más acertado, ya que los encabezados de 12 bytes harían que el ataque sea aún más eficiente.

El ataque es aplicable con el modo de cifrado **CBC** (_Cadena de Cifrado Por Bloques_) y con el esquema **MAC** (_Código de Autenticación de Mensaje_). El cálculo **TLS MAC** incluye 13 bytes de información de encabezado (5 bytes de encabezado TLS más 8 bytes de número de secuencia TLS) y es por eso que se llama **Lucky 13**, el cual explota una falla mencionada en la [**RFC 5246**](https://tools.ietf.org/html/rfc5246).

### POC 

```bash
openssl s_client -cipher CBC_CIPHER -connect example.com:443
```

### MITIGACION

-   Escriba el código de tal manera que los casos de éxito y error consuman el mismo tiempo para que un atacante no pueda medir la diferencia de tiempo.
-   Utilice cifrados AEAD como AES-GCM, estos cifrados calculan MAC mientras cifran el mensaje en sí.
-   Cifre el texto sin formato primero, luego genere un MAC basado en el texto cifrado resultante.
-   Utilice versiones no vulnerables de las librerías que implemente en sus sistemas, como por ejemplo, la versión 1.1.1.* de OpenSSL.

[https://blog.isecauditors.com/2020/04/seguridad-ssl-tls-lucky13.html](https://blog.isecauditors.com/2020/04/seguridad-ssl-tls-lucky13.html)

## LOGJAM

El ataque LOGJAM es una vulnerabilidad SSL/TLS que permite a los atacantes interceptar conexiones HTTPS entre clientes y servidores vulnerables y forzarlos a usar criptografía de "grado de exportación", que luego se puede descifrar o modificar. Esta alerta de vulnerabilidad se emite cuando se encuentra un sitio web compatible con conjuntos de cifrado de exportación DH(E) o conjuntos de cifrado DHE que no exportan utilizando primos DH de menos de 1024 bits o primos estándar DH de uso común de hasta 1024 bits.

### POC

```bash
# Check the "Server Temp Key" response is bigger than 1024 (only in OpenSSL 1.0.2 or better)
openssl s_client -connect www.example.com:443 -cipher "EDH"
```

### MITIGACION

Vuelva a configurar el servidor SSL/TLS afectado para deshabilitar la compatibilidad con cualquier suite DHE_EXPORT, para primos DH de menos de 1024 bits y para primos estándar DH de hasta 1024 bits. Consulte la "Guía para implementar Diffie-Hellman para TLS" para obtener más información sobre cómo configurar los sistemas afectados en consecuencia.

## SSLv2 Y SSLv3 SUPPORT

```bash
# If is supported this will return the server certificate information if not, error
openssl s_client –ssl2 -connect example.com:443
```

```bash
# If is supported this will return the server certificate information if not, error
openssl s_client -ssl3 -connect google.com:443
```

## CIPHER SUITES

```bash
# Cipher Suites
nmap --script ssl-enum-ciphers -p 443 example.com

# - Anon cypher (fail)
openssl s_client -cipher aNULL -connect example.com:443

# - DES Cipher (fail)
openssl s_client -cipher DES -connect example.com:443

# - 3DES Cipher (fail)
openssl s_client -cipher 3DES -connect example.com:443

# - Export Cipher (fail)
openssl s_client -cipher EXPORT -connect example.com:443

# - Low Cipher (fail)
openssl s_client -cipher LOW -connect example.com:443

# - RC4 Cipher (fail)
openssl s_client -cipher RC4 -connect example.com:443

# - NULL Cipher (fail)
openssl s_client -cipher NULL -connect example.com:443

# - Perfect Forward Secrecy Cipher (This should NOT fail):
openssl s_client -cipher EECDH, EDH NULL -connect example.com:443
```

## DROWN

```bash
# Check for "SSLv2 supported"
nmap –p- –sV –sC example.com
```

## ¿Cuál es la diferencia entre TLS 1.3 y TLS 1.2?

TLS 1.3 es la última versión del [protocolo TLS](https://www.cloudflare.com/learning/ssl/transport-layer-security-tls/). TLS, que es utilizado por [HTTPS](https://www.cloudflare.com/learning/ddos/glossary/hypertext-transfer-protocol-http/) y otros protocolos de red para la [encriptación](https://www.cloudflare.com/learning/ssl/what-is-encryption/), es la versión moderna de [SSL](https://www.cloudflare.com/learning/ssl/what-is-ssl/). TLS 1.3 eliminó la compatibilidad con funciones criptográficas más antiguas y menos seguras, y aceleró los [protocolos de enlace de TLS](https://www.cloudflare.com/learning/ssl/what-happens-in-a-tls-handshake/), entre otras mejoras.

Para contextualizar, el Grupo de trabajo de ingeniería de Internet (IETF) publicó TLS 1.3 en agosto de 2018. TLS 1.2, la versión a la que sustituye, se estandarizó una década antes, en 2008.

## ¿Qué ventajas tiene utilizar la última versión de TLS?

En pocas palabras, TLS 1.3 es más rápido y más seguro que TLS 1.2. Uno de los cambios que hace que TLS 1.3 sea más rápido es una actualización en la forma en la que funciona el protocolo de enlace TLS: los protocolos de enlace de TLS en TLS 1.3 solo requieren un viaje de ida y vuelta (o comunicación de ida y vuelta) en lugar de dos, lo cual reduce el proceso a unos pocos milisegundos. Y en los casos en que el cliente se haya conectado antes a un sitio web, el protocolo de enlace TLS tendrá cero viajes de ida y vuelta. Esto hace que las conexiones HTTPS sean más rápidas, lo cual reduce la [latencia](https://www.cloudflare.com/learning/performance/glossary/what-is-latency/) y mejora la experiencia general del usuario.

Muchas de las principales vulnerabilidades de TLS 1.2 tenían que ver con los algoritmos criptográficos más antiguos con los que seguían siendo compatibles. TLS 1.3 deja de ser vulnerable con estos algoritmos criptográficos vulnerables y, por tanto, es menos vulnerable a los ciberataques.

FUENTE:

- [https://www.acunetix.com/blog/articles/tls-vulnerabilities-attacks-final-part/](https://www.acunetix.com/blog/articles/tls-vulnerabilities-attacks-final-part/)
- [https://www.cloudflare.com/es-es/learning/ssl/why-use-tls-1.3/](https://www.cloudflare.com/es-es/learning/ssl/why-use-tls-1.3/)
- [https://beaglesecurity.com/blog/vulnerability/sweet32-attack.html](https://beaglesecurity.com/blog/vulnerability/sweet32-attack.html)
- [https://www.ssl.com/es/c%C3%B3mo/apague-ssl-3-0-y-tls-1-0-en-su-navegador/](https://www.ssl.com/es/c%C3%B3mo/apague-ssl-3-0-y-tls-1-0-en-su-navegador/)
- [https://pentestbook.six2dez.com/enumeration/ssl-tls](https://pentestbook.six2dez.com/enumeration/ssl-tls)